---

postgresql_version: 9.4
postgresql_repository: official
#postgresql_repository: distro

postgresql_cluster_name: main
postgresql_dev: true
postgresql_contrib: true

postgresql_replication: true
postgresql_replication_role: master

postgresql_encoding: UTF-8
postgresql_locale: en_US.UTF-8

postgresql_extensions:
  - pg_extwlist

postgresql_ssl:
  cert: |
    cenas
  cert_filepath: /etc/postgresql/cert.pem
  key: |
    cenas
  key_filepath: /etc/postgresql/key.pem

postgresql_users_replication:
  - user: replication
    password: "password"
    state: present
    databases:
      - database: replication
        connection: host
        address: "10.0.0.0/8"
        auth: md5

postgresql_users_default:
  - user: postgres
    databases:
      - database: all
        connection: local
        auth: trust
  - user: all
    databases:
      - database: all
        connection: local
        auth: trust
      - database: all
        connection: host
        address: 127.0.0.1/32
        auth: trust
      - database: all
        connection: host
        address: ::1/128
        auth: trust

postgresql_users:
  - user: postgres
    password: "mypassword"
    state: present
    roles:
      - superuser
      - createdb
      - login
      - replication
    databases:
      - database: xpto
        connection: local
        auth: md5
      - database: xpto2
        connection: host
        address: "127.0.0.1/32"
        auth: md5
  - user: xpto
    password: "mypassword"
    state: present
    roles:
      - superuser
      - createdb
      - login
      - replication
#    databases:
#      - database: xpto
#        connection: "local" # ou entao um ip
#        address: "127.0.0.1/32"
#        auth: "md5 cenas"

postgresql_databases:
  - database: cenas
#    owner: "myuser"
    encoding: "UTF-8"
    template: "template0"
    locale: "en_US.UTF-8"
    state: present

postgresql_config:
  data_directory: '/var/lib/postgresql/{{ postgresql_version }}/{{ postgresql_cluster_name }}'
  hba_file: '/etc/postgresql/{{ postgresql_version }}/{{ postgresql_cluster_name }}/pg_hba.conf'
  ident_file: '/etc/postgresql/{{ postgresql_version }}/{{ postgresql_cluster_name }}/pg_ident.conf'
  external_pid_file: '/var/run/postgresql/{{ postgresql_version }}-{{ postgresql_cluster_name }}.pid'
  max_connections: 100
  shared_buffers: 128MB
  log_timezone: 'UTC'
  datestyle: 'iso, mdy'
  timezone: 'UTC'
  lc_messages: 'en_US.utf8'
  lc_monetary: 'en_US.utf8'
  lc_numeric: 'en_US.utf8'
  lc_time: 'en_US.utf8'
  default_text_search_config: 'pg_catalog.english'
  listen_addresses: "*"
  wal_level: hot_standby
  wal_buffers: 16MB
  wal_keep_segments: 1000
  max_wal_senders: 3
  checkpoint_segments: 32
