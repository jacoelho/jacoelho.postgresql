---

- name: create ssl directories if needed
  file:
    path: "{{ item }}"
    owner: postgres
    group: postgres
    state: directory
    mode: 0700
  with_items:
    - postgresql_cfg_ssl_cert_file | dirname
    - postgresql_cfg_ssl_key_file | dirname

- name: Copying ssl keys
  copy:
    content: "{{ postgresql_ssl.key }}"
    dest: "{{ postgresql_cfg_ssl_key_file }}"
    owner: postgres
    group: postgres
    mode: 0600

- name: Copying ssl certs
  copy:
    content: "{{ postgresql_ssl.cert }}"
    dest: "{{ postgresql_cfg_ssl_cert_file }}"
    owner: postgres
    group: postgres
    mode: 0644
